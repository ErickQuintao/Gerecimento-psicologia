<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Detalhes do Atendimento</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body onload="carregarAtendimento()">
    <div class="container mt-5">
        <h2>Detalhes do Atendimento</h2>
        <h3>Dados Atuais do Atendimento</h3>
        <p><strong>Nome:</strong> <span id="nomeAtendimento"></span></p>
        <p><strong>Horário Inicial:</strong> <span id="horarioInicialAtendimento"></span></p>
        <p><strong>Horário Final:</strong> <span id="horarioFinalAtendimento"></span></p>
        <p><strong>Valor:</strong> <span id="valorAtendimento"></span></p>
        <p><strong>Desconto:</strong> <span id="descontoAtendimento"></span></p>
        <p><strong>Valor Total:</strong> <span id="valorTotalAtendimento"></span></p>
        <p><strong>Método de Pagamento:</strong> <span id="metodoPagamentoAtendimento"></span></p>
        <p><strong>Status:</strong> <span id="statusAtendimento"></span></p>
        <p><strong>Convênio:</strong> <span id="convenioAtendimento"></span></p>
        <p><strong>Descrição:</strong> <span id="descricaoAtendimento"></span></p>

        <h3>Atualizar Atendimento</h3>
        <form id="atendimentoForm">
            <input type="hidden" id="atendimentoId" th:value="${id}" />
            <button type="button" onclick="atualizarAtendimento()" class="btn btn-primary mt-3">Alterar</button>
            <button type="button" onclick="excluirAtendimento()" class="btn btn-danger mt-3">Excluir</button>
        </form>

        <a href="/atendimentos/listar" class="btn btn-secondary mt-3">Voltar para a Lista</a>
    </div>

    <script>
        function carregarAtendimento() {
            // Pega o ID do atendimento diretamente da URL
            var id = window.location.pathname.split("/").pop(); // Obtém o último segmento da URL

            $.ajax({
                url: '/atendimentos/detalhes/json/' + id, // Aqui você pode usar o endpoint que retorna os dados em JSON
                method: 'GET',
                success: function(atendimento) {
                    // Popula os dados na página
                    $('#nomeAtendimento').text(atendimento.nome);
                    $('#horarioInicialAtendimento').text(new Date(atendimento.horarioInicial).toLocaleString());
                    $('#horarioFinalAtendimento').text(new Date(atendimento.horarioFinal).toLocaleString());
                    $('#valorAtendimento').text(atendimento.valor);
                    $('#descontoAtendimento').text(atendimento.desconto);
                    $('#valorTotalAtendimento').text(atendimento.valorTotal);
                    $('#metodoPagamentoAtendimento').text(atendimento.metodoPagamento);
                    $('#statusAtendimento').text(atendimento.status);
                    $('#convenioAtendimento').text(atendimento.convenio);
                    $('#descricaoAtendimento').text(atendimento.descricao);
                },
                error: function(error) {
                    alert('Erro ao carregar detalhes do atendimento.');
                }
            });
        }
        
        function atualizarAtendimento() {
       
            var id = document.getElementById("atendimentoId").value;
            var nome = document.getElementById("nome").value;
            var horarioInicial = document.getElementById("horarioInicial").value;
            var horarioFinal = document.getElementById("horarioFinal").value;
            var valor = document.getElementById("valor").value;
            var desconto = document.getElementById("desconto").value;
            var valorTotal = document.getElementById("valorTotal").value;
            var metodoPagamento = document.getElementById("metodoPagamento").value;
            var status = document.getElementById("status").value;
            var convenio = document.getElementById("convenio").value;
            var descricao = document.getElementById("descricao").value;

            $.ajax({
                url: '/atendimentos/atualizar/' + id,
                method: 'PUT',
                data: {
                    nome: nome,
                    horarioInicial: horarioInicial,
                    horarioFinal: horarioFinal,
                    valor: valor,
                    desconto: desconto,
                    valorTotal: valorTotal,
                    metodoPagamento: metodoPagamento,
                    status: status,
                    convenio: convenio,
                    descricao: descricao
                },
                success: function(response) {
                    // Lógica para tratar a resposta, como redirecionar para a lista
                    window.location.href = '/atendimentos/listar';
                },
                error: function(error) {
                    // Lógica para tratar erro
                    alert('Erro ao atualizar atendimento.');
                }
            });
            
        }

        function excluirAtendimento() {
            var id = document.getElementById("atendimentoId").value;

            $.ajax({
                url: '/atendimentos/excluir/' + id,
                method: 'DELETE',
                success: function(response) {
                    // Lógica para tratar a resposta, como redirecionar para a lista
                    window.location.href = '/listar-atendimentos';s
                },
                error: function(error) {
                    // Lógica para tratar erro
                    alert('Erro ao excluir atendimento.');
                }
            });
        }
    </script>
</body>
</html>


